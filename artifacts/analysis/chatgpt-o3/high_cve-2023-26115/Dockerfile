# Dockerfile‑redos
FROM node:18-slim
WORKDIR /app

# 1. Install vulnerable version
RUN npm init -y && npm install word-wrap@1.2.3 express@4

# 2. Minimal API that calls wordWrap() on user input
RUN printf '%s\n' \
"const wrap = require('word-wrap');" \
"const express = require('express'); const app = express();" \
"app.use(express.text({ limit: '100mb' }));" \
"const indent = 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'; // 48 × 'A'" \
"app.post('/wrap', (req, res) => {" \
"  for (let i = 0; i < 100; i++) {" \
"    wrap(req.body, { trim: true, indent });" \
"  }" \
"  res.send('wrapped');" \
"});" \
"app.listen(3000, () => console.log('Server running on 3000')); " \
> server.js

EXPOSE 3000
CMD ["node","server.js"]
